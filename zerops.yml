wp:
  build:
    base:
      - php@8.1
    prepare:
      - curl -sS https://raw.githubusercontent.com/wp-cli/builds/gh-pages/phar/wp-cli.phar -o wp-cli.phar
      - chmod +x wp-cli.phar
      - sudo mv wp-cli.phar /usr/local/bin/wp
    build:
      - composer update
      - |
        if ! $(wp core is-installed); then
          wp core install --url=yourdomain.com --title="Site Title" --admin_user="adminusername" --admin_password="adminpassword" --admin_email="admin@email.com"
        fi
      - wp plugin activate --all --allow-root
    deploy: [ ./ ]
  run:
    init:
      - |
        if ! zcli bucket s3 create storage $WORDPRESS_STORAGE_BUCKET --x-amz-acl=public-read; then
          echo "Skipping, bucket already exists."
        fi
    documentRoot: ''

